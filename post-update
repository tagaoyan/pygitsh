#!/bin/sh

if which fifoclient.py &> /dev/null; then
    echo 'detected fifohook/client'
else
    echo 'no deploy tool installed'
    exit
fi

enabled="$(git config --bool deploy.use || printf 'false')"
name="$(git config deploy.name)"
key="$(git config deploy.key)"

if [ "$enabled" == 'true' ]; then
    echo "calling deploy hook."
    echo "we do not guarantee this build to succeed."
    timeout 10 fifoclient.py "$name" "$key" &
else
    echo "no deploy needed."
fi
